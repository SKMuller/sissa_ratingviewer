<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSV SISSA Rating Lijst</title>
    <!-- Premium Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2c3e50;
            /* Deep Blue/Grey */
            --accent-color: #3498db;
            /* Brighter Blue for accents */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2d3436;
            --subtext-color: #636e72;
            --success-color: #00b894;
            --danger-color: #d63031;
            --neutral-color: #b2bec3;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            --radius: 12px;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 30px 40px;
            border-bottom: 1px solid #f1f1f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-content h1 {
            margin: 0;
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .refresh-info {
            font-size: 0.85rem;
            color: var(--subtext-color);
            margin-top: 5px;
        }

        .search-wrapper {
            position: relative;
        }

        .search-wrapper input {
            padding: 10px 15px;
            padding-left: 35px;
            border-radius: 20px;
            border: 1px solid #e1e1e1;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            background: #fdfdfd;
            width: 200px;
            transition: all 0.2s;
        }

        .search-wrapper input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            width: 240px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--subtext-color);
            width: 14px;
            height: 14px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        th {
            padding: 18px 25px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--subtext-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
            position: sticky;
            top: 0;
            user-select: none;
            white-space: nowrap;
        }

        th:hover {
            color: var(--primary-color);
            background-color: #fcfcfc;
        }

        th.sort-active {
            color: var(--primary-color);
            background-color: #f1f3f5;
            border-bottom: 2px solid var(--accent-color);
        }

        th[data-sort]::after {
            content: '↕';
            display: inline-block;
            margin-left: 8px;
            opacity: 0.3;
            font-size: 0.8rem;
            transition: opacity 0.2s;
        }

        th.sort-active::after {
            opacity: 1;
            content: '↓';
            color: var(--accent-color);
        }

        th.sort-active.sort-asc::after {
            content: '↑';
        }

        th.rank-col::after {
            content: none;
        }

        td {
            padding: 16px 25px;
            border-bottom: 1px solid #f5f6fa;
            font-size: 1rem;
            vertical-align: middle;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background-color: #fafbfc;
        }

        td.col-highlight {
            background-color: #fbfbfc;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            position: relative;
            transition: color 0.2s;
        }

        a:hover {
            color: var(--accent-color);
        }

        .rank-col {
            color: var(--subtext-color);
            font-weight: 500;
            width: 50px;
            text-align: center;
        }

        .col-rating {
            width: 100px;
            text-align: center;
        }

        .col-change {
            width: 100px;
            text-align: center;
        }

        .col-games {
            width: 100px;
            text-align: center;
        }

        .rating-val {
            display: inline-block;
            font-weight: 400;
            color: var(--text-color);
            min-width: 40px;
            text-align: center;
            /* Keep numbers aligned */
        }

        .rating-val.high {
            font-weight: 700;
            color: #2c3e50;
        }

        .change {
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .change.positive {
            color: var(--success-color);
        }

        .change.negative {
            color: var(--danger-color);
        }

        .change.neutral {
            color: var(--neutral-color);
        }

        .games {
            color: var(--subtext-color);
            font-weight: 500;
        }

        /* Loading */
        #loading {
            padding: 60px;
            text-align: center;
            color: var(--subtext-color);
        }

        .no-results {
            padding: 40px;
            text-align: center;
            color: var(--subtext-color);
            font-style: italic;
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 600px) {
            .container {
                border-radius: 0;
                box-shadow: none;
            }

            th,
            td {
                padding: 12px 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-wrapper input {
                width: 100%;
                box-sizing: border-box;
            }

            .search-wrapper input:focus {
                width: 100%;
            }
        }

        /* Tab Styling */
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f1f1f1;
            padding-bottom: 2px;
        }

        .tab-btn {
            background: none;
            border: none;
            font-family: 'Outfit', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--subtext-color);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            margin-bottom: -4px;
            /* overlap border */
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--accent-color);
            border-bottom: 3px solid var(--accent-color);
        }

        .hidden-col {
            display: none;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <div class="header-content">
                <h1>SISSA Ratinglijst</h1>
                <div class="refresh-info" id="last-updated">Laden...</div>
            </div>
            <div class="search-wrapper">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="searchInput" placeholder="Zoek speler..." onkeyup="filterTable()">
            </div>
        </header>

        <!-- Tabs -->
        <div style="padding: 0 40px; margin-top: 20px;">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('knsb')" id="tab-knsb">KNSB</button>
                <button class="tab-btn" onclick="switchTab('fide')" id="tab-fide">FIDE</button>
            </div>
        </div>

        <div id="loading">Gegevens laden...</div>

        <div class="table-wrapper" id="content" style="display: none;">
            <table id="rating-table">
                <thead>
                    <tr>
                        <th class="rank-col">#</th>
                        <th onclick="sortTable('name')" data-sort="name">Naam</th>
                        <th class="col-title" onclick="sortTable('title')" data-sort="title">Titel</th>
                        <th class="col-fed" onclick="sortTable('video')" data-sort="country">Fed</th>
                        <th class="col-yob" onclick="sortTable('birthday')" data-sort="birthday">Geb</th>

                        <!-- FIDE Group -->
                        <th class="col-fide hidden-col col-rating" onclick="sortTable('fide')" data-sort="fide">FIDE
                        </th>
                        <th class="col-fide hidden-col col-change" onclick="sortTable('fide_change')"
                            data-sort="fide_change">+/-
                        </th>
                        <th class="col-fide hidden-col col-games" onclick="sortTable('fide_games')"
                            data-sort="fide_games">Partijen
                        </th>

                        <!-- KNSB Group -->
                        <th class="col-knsb col-rating" onclick="sortTable('rating')" data-sort="rating">KNSB</th>
                        <th class="col-knsb col-change" onclick="sortTable('change')" data-sort="change">+/-</th>
                        <th class="col-knsb col-games" onclick="sortTable('games')" data-sort="games">Partijen</th>
                    </tr>
                </thead>
                <tbody id="player-list">
                    <!-- Rows will be injected here -->
                </tbody>
            </table>
            <div id="no-results" class="no-results">Geen spelers gevonden.</div>
        </div>
    </div>

    <script>
        let playersData = [];
        let currentSort = { key: 'rating', dir: 'desc' };
        let activeTab = 'knsb'; // Default

        document.addEventListener('DOMContentLoaded', () => {
            fetch('sissa_ratings.json')
                .then(response => {
                    if (!response.ok) throw new Error('Data niet gevonden');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';

                    const date = new Date(data.timestamp);
                    document.getElementById('last-updated').innerText = 'Laatste update: ' + date.toLocaleDateString('nl-NL');

                    playersData = data.players;
                    renderTable();
                })
                .catch(error => {
                    document.getElementById('loading').innerHTML = 'Fout bij het laden van de gegevens.<br><small>' + error.message + '</small>';
                });
        });

        function switchTab(tab) {
            activeTab = tab;

            // Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');

            // Set default sort for the tab (improves UX)
            if (tab === 'fide') {
                currentSort = { key: 'fide', dir: 'desc' };
            } else {
                currentSort = { key: 'rating', dir: 'desc' };
            }

            renderTable();
        }

        function renderTable(data = playersData) {
            const tbody = document.getElementById('player-list');
            const noResults = document.getElementById('no-results');

            tbody.innerHTML = '';

            if (data.length === 0) {
                noResults.style.display = 'block';
                return;
            } else {
                noResults.style.display = 'none';
            }

            // Manage Column Visibility
            const isFide = activeTab === 'fide';

            // Toggle Headers
            document.querySelectorAll('.col-fide').forEach(el => el.style.display = isFide ? 'table-cell' : 'none');
            document.querySelectorAll('.col-knsb').forEach(el => el.style.display = !isFide ? 'table-cell' : 'none');

            // Apply sorting
            data.sort((a, b) => {
                let valA, valB;

                switch (currentSort.key) {
                    case 'name':
                        valA = a.name.toLowerCase();
                        valB = b.name.toLowerCase();
                        break;
                    case 'title':
                        valA = (a.title || '').toLowerCase();
                        valB = (b.title || '').toLowerCase();
                        break;
                    case 'country':
                        valA = (a.country || '').toLowerCase();
                        valB = (b.country || '').toLowerCase();
                        break;
                    case 'birthday':
                        valA = parseInt(a.birthday) || 0;
                        valB = parseInt(b.birthday) || 0;
                        break;
                    case 'fide':
                        valA = parseInt(a.fide_rating) || 0;
                        valB = parseInt(b.fide_rating) || 0;
                        break;
                    case 'fide_change':
                        valA = parseFloat(a.fide_change) || 0;
                        valB = parseFloat(b.fide_change) || 0;
                        break;
                    case 'fide_games':
                        valA = parseInt(a.fide_games) || 0;
                        valB = parseInt(b.fide_games) || 0;
                        break;
                    case 'rating':
                        valA = parseInt(a.current_rating) || 0;
                        valB = parseInt(b.current_rating) || 0;
                        break;
                    case 'change':
                        valA = parseInt(a.rating_change) || 0;
                        valB = parseInt(b.rating_change) || 0;
                        break;
                    case 'games':
                        valA = parseInt(a.games_played) || 0;
                        valB = parseInt(b.games_played) || 0;
                        break;
                }

                if (valA < valB) return currentSort.dir === 'asc' ? -1 : 1;
                if (valA > valB) return currentSort.dir === 'asc' ? 1 : -1;
                return 0;
            });

            // Update Header Styling
            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-active', 'sort-asc', 'sort-desc');
            });

            const activeHeader = document.querySelector(`th[data-sort="${currentSort.key}"]`);
            if (activeHeader) {
                activeHeader.classList.add('sort-active');
                activeHeader.classList.add(currentSort.dir === 'asc' ? 'sort-asc' : 'sort-desc');
            }

            data.forEach((player, index) => {
                const tr = document.createElement('tr');

                // Hide/Show logic for cells
                const fideStyle = isFide ? '' : 'display: none;';
                const knsbStyle = !isFide ? '' : 'display: none;';

                let changeVal = parseInt(player.rating_change) || 0;
                let changeClass = 'neutral';
                let changeText = changeVal;

                if (changeVal > 0) {
                    changeClass = 'positive';
                    changeText = '+' + changeVal;
                } else if (changeVal < 0) {
                    changeClass = 'negative';
                } else {
                    changeText = '-';
                }

                let ratingClass = 'rating-pill';
                let ratingText = player.current_rating;
                let ratingVal = parseInt(player.current_rating);

                if (!player.current_rating || isNaN(ratingVal) || ratingVal === 0) {
                    ratingText = 'Geen';
                    ratingClass += ' neutral'; // You might need to add css for this or reuse existing
                    ratingClass = 'rating-pill'; // Reset if needed, or just default style
                    // Let's style it bit different? 
                    // The default pill is grey (#dfe6e9), which fits "Geen" well.
                } else if (ratingVal >= 2000) {
                    ratingClass += ' high';
                }

                // FIDE Rating style
                let fideVal = parseInt(player.fide_rating) || 0;
                let fideText = fideVal > 0 ? fideVal : '-';
                let fideClass = '';
                if (fideVal >= 2000) fideClass = 'font-weight: 600; color: #2c3e50;';

                // FIDE Change Styling
                let fideChangeVal = parseFloat(player.fide_change) || 0;
                let fideChangeClass = 'neutral';
                let fideChangeText = player.fide_change ? player.fide_change : '-';

                if (fideChangeVal > 0) {
                    fideChangeClass = 'positive';
                    if (!fideChangeText.startsWith('+')) fideChangeText = '+' + fideChangeText;
                } else if (fideChangeVal < 0) {
                    fideChangeClass = 'negative';
                } else {
                    fideChangeText = '-';
                }

                let fideGames = player.fide_games || '-';

                // Highlight cells matching sort key
                const hl = (key) => currentSort.key === key ? 'col-highlight' : '';

                // Rank is index + 1
                tr.innerHTML = `
                    <td class="rank-col">${index + 1}</td>
                    <td class="${hl('name')}"><a href="${player.profile_url}" target="_blank">${player.name}</a></td>
                    <td class="${hl('title')} col-title">${player.title || ''}</td>
                    <td class="${hl('country')} col-fed">${player.country || ''}</td>
                    <td class="${hl('birthday')} col-yob">${player.birthday || ''}</td>
                    
                    <td class="${hl('fide')} col-rating" style="${fideStyle}"><span class="${fideVal >= 2000 ? 'rating-val high' : 'rating-val'}">${fideText}</span></td>
                    <td class="${hl('fide_change')} col-change" style="${fideStyle}"><div class="change ${fideChangeClass}">${fideChangeText}</div></td>
                    <td class="${hl('fide_games')} col-games" style="${fideStyle}"><span class="games">${fideGames}</span></td>
                    
                    <td class="${hl('rating')} col-rating" style="${knsbStyle}"><span class="${ratingVal >= 2000 ? 'rating-val high' : 'rating-val'}">${ratingText}</span></td>
                    <td class="${hl('change')} col-change" style="${knsbStyle}"><div class="change ${changeClass}">${changeText}</div></td>
                    <td class="${hl('games')} col-games" style="${knsbStyle}"><span class="games">${player.games_played}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function sortTable(key) {
            if (currentSort.key === key) {
                currentSort.dir = currentSort.dir === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.key = key;
                // Default directions
                if (key === 'name') currentSort.dir = 'asc';
                else currentSort.dir = 'desc'; // numbers desc usually
            }

            // Re-render with current filter applied
            filterTable();
        }

        function filterTable() {
            const query = document.getElementById('searchInput').value.toLowerCase();

            const filtered = playersData.filter(player => {
                return player.name.toLowerCase().includes(query);
            });

            renderTable(filtered);
        }
    </script>

</body>

</html>